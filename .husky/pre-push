#!/bin/sh
# Pre-push hook for B3 AI Analysis Platform
# Validates: Build success (backend + frontend)

echo "üöÄ Pre-push validation starting..."
echo ""
echo "This may take a few minutes..."
echo ""

ERRORS=0

# Backend build check
echo "üì¶ [Backend] Build validation..."
cd backend
BUILD_OUTPUT=$(npm run build 2>&1)
if [ $? -ne 0 ]; then
    echo "‚ùå Backend build FAILED!"
    echo "$BUILD_OUTPUT" | tail -20
    ERRORS=$((ERRORS + 1))
else
    echo "‚úÖ Backend build: SUCCESS"
fi
cd ..

# Frontend build check
echo ""
echo "üñ•Ô∏è  [Frontend] Build validation..."
cd frontend
BUILD_OUTPUT=$(npm run build 2>&1)
if [ $? -ne 0 ]; then
    echo "‚ùå Frontend build FAILED!"
    echo "$BUILD_OUTPUT" | tail -20
    ERRORS=$((ERRORS + 1))
else
    echo "‚úÖ Frontend build: SUCCESS"
fi
cd ..

# Summary
echo ""
echo "=========================================="
if [ $ERRORS -gt 0 ]; then
    echo "‚ùå Pre-push FAILED: $ERRORS error(s)"
    echo ""
    echo "Fix the build errors before pushing."
    echo "To bypass (emergency only): git push --no-verify"
    exit 1
else
    echo "‚úÖ Pre-push PASSED - Ready to push!"
    echo "=========================================="
fi
