# PostgreSQL configuration for B3 AI Analysis Platform
# This file is mounted to /etc/postgresql/postgresql.conf in the container

# ============================================
# PERFORMANCE TUNING
# ============================================

# Memory Settings
shared_buffers = 256MB              # 25% of RAM for cache (4GB system)
effective_cache_size = 1GB          # 25% of RAM for OS + Postgres cache
work_mem = 10MB                     # Memory per operation (sort, hash)
maintenance_work_mem = 64MB         # Memory for VACUUM, CREATE INDEX

# Checkpoint Settings
checkpoint_completion_target = 0.9  # Spread checkpoints over 90% of interval
wal_buffers = 16MB                  # Write-Ahead Log buffer

# Query Planner
default_statistics_target = 100     # Statistics for query planner
random_page_cost = 1.1              # SSD-optimized (default 4.0 for HDD)
effective_io_concurrency = 200      # Concurrent I/O operations (SSD)

# ============================================
# TIMESCALEDB SETTINGS
# ============================================

# Enable TimescaleDB extension
shared_preload_libraries = 'timescaledb'

# TimescaleDB-specific tuning
timescaledb.max_background_workers = 8

# ============================================
# LOGGING
# ============================================

# Log slow queries (> 1 second)
log_min_duration_statement = 1000

# Log connections and disconnections
log_connections = on
log_disconnections = on

# Log line format
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# ============================================
# CONNECTION SETTINGS
# ============================================

max_connections = 100               # Maximum concurrent connections
listen_addresses = '*'              # Listen on all interfaces
